<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="${isEdit} ? 'Update Vehicle' : 'Add Vehicle'"></title>
<style>
    body { font-family: Arial, sans-serif; background-color: #f6f8fa; margin: 0; padding: 30px;}
    form { max-width: 600px; margin: 50px auto; background-color: #ffffff; padding: 35px 40px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08);}
    h2 { text-align: left; color: #1aa546; font-size: 20px; margin-bottom: 25px; font-weight: bold;}
    label { font-weight: bold; color: #333; display: block; margin-bottom: 6px; margin-top: 16px; font-size: 14px;}
    input, select { width: 100%; padding: 12px 14px; border: 1.5px solid #cfcfcf; border-radius: 8px; font-size: 14px; outline: none; background-color: #fff; box-sizing: border-box; transition: border-color 0.25s, box-shadow 0.25s;}
    input:focus, select:focus { border-color: #1aa546; box-shadow: 0 0 0 3px rgba(0,152,121,0.15);}
    .actions { display: flex; justify-content: center; gap: 15px; margin-top: 30px;}
    button { padding: 12px 28px; border-radius: 6px; border: none; font-weight: bold; cursor: pointer; transition: all 0.2s ease;}
    button.cancel { background-color: #808080; color: white;}
    button.cancel:hover { background-color: #666666;}
    button[type="submit"] { background-color: #1aa546; color: white;}
    button[type="submit"]:hover { background-color: #007f66;}
    @media (max-width: 768px) { form { width: 90%; padding: 25px; }}
</style>

</head>

<body>
<div th:replace="~{fragments/navbar :: navbar}"></div>

<form th:action="${isEdit} ? @{'/vehicles/' + ${vehicleId} + '/update'} : @{/vehicles/create}" th:object="${vehicle}" method="post">
    <h2 th:text="${isEdit} ? 'Update Vehicle' : 'Create a New Vehicle'"></h2>
    <input type="hidden" name="_method" value="put" th:if="${isEdit}"/>

    <label>Rental Vendor</label>
    <select id="vendorSelect" th:field="*{rentalVendorId}" required>
        <option value="">-- Select Vendor --</option>
        <option th:each="vendor : ${vendors}"
                th:value="${vendor.id}"
                th:text="${vendor.name}">
        </option>
    </select>

    <label>Vehicle Type</label>
    <select th:field="*{type}" required>
        <option value="">-- Select Type --</option>
        <option th:value="Sedan">Sedan</option>
        <option th:value="SUV">SUV</option>
        <option th:value="MPV">MPV</option>
        <option th:value="Luxury">Luxury</option>
    </select>

    <label>Vehicle Brand</label>
    <input type="text" th:field="*{brand}" placeholder="Enter brand">

    <label>Vehicle Model</label>
    <input type="text" th:field="*{model}" placeholder="Enter model">

    <label>Production Year</label>
    <input type="number" th:field="*{productionYear}" min="1990" max="2025">

    <label>Location</label>
    <select id="locationSelect" th:field="*{location}" required>
        <option value="">-- Select Location --</option>
    </select>

    <label>License Plate</label>
    <input type="text" th:field="*{licensePlate}" placeholder="Enter license plate">

    <label>Capacity</label>
    <input type="number" th:field="*{capacity}" min="1">

    <label>Transmission</label>
    <select th:field="*{transmission}">
        <option value="">-- Select Transmission --</option>
        <option th:value="Manual">Manual</option>
        <option th:value="Automatic">Automatic</option>
    </select>

    <label>Fuel Type</label>
    <select th:field="*{fuelType}">
        <option value="">-- Select Fuel Type --</option>
        <option th:value="Bensin">Bensin</option>
        <option th:value="Diesel">Diesel</option>
        <option th:value="Hybrid">Hybrid</option>
        <option th:value="Listrik">Listrik</option>
    </select>

    <label>Price per Day</label>
    <input type="number" th:field="*{price}" min="0">

    <div th:if="${isEdit}">
        <label>Status</label>
        <select th:field="*{status}">
            <option th:value="'Available'">Available</option>
            <option th:value="'Unavailable'">Unavailable</option>
            <option th:value="'In Use'">In Use</option>
        </select>
    </div>

    <div class="actions">
        <a href="/vehicles"><button type="button" class="cancel">Cancel</button></a>
        <button type="submit">Save</button>
    </div>
</form>

<script th:inline="javascript">
/*<![CDATA[*/
const rentalVendorLocationsJson = /*[[${rentalVendorLocations}]]*/ {};

document.addEventListener("DOMContentLoaded", function() {
    const vendorSelect = document.getElementById("vendorSelect");
    const locationSelect = document.getElementById("locationSelect");

    function populateLocations(vendorId, selectedLocation) {
        locationSelect.innerHTML = '<option value="">-- Select Location --</option>';
        if (vendorId && rentalVendorLocationsJson[vendorId]) {
            rentalVendorLocationsJson[vendorId].forEach(loc => {
                const opt = document.createElement("option");
                opt.value = loc;
                opt.textContent = loc;
                if (loc === selectedLocation) opt.selected = true;
                locationSelect.appendChild(opt);
            });
        }
    }

    vendorSelect.addEventListener("change", function() {
        populateLocations(this.value, null);
    });

    const isEdit = /*[[${isEdit}]]*/ false;
    const currentVendorId = vendorSelect.value;
    const currentLocation = /*[['${vehicle.location}']]*/ '';

    if (isEdit && currentVendorId) {
        populateLocations(currentVendorId, currentLocation);
    }
});
/*]]>*/
</script>
</body>
</html>
